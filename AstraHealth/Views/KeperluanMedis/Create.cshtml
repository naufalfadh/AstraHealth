@model AstraHealth.Models.KeperluanAlatMedis

@{
    ViewData["Title"] = "Tambah Keperluan Alat Medis";
}
@{
    var httpContext = ViewContext.HttpContext;
}

<style>
    .input-with-border {
        border: 1px solid #ddd; /* Warna dan ketebalan garis tepi */
        border-radius: 4px; /* Bordes sudut */
    }


    .card {
        padding-left: 50px; /* Sesuaikan dengan jumlah padding yang diinginkan */
        padding-right: 50px; /* Sesuaikan dengan jumlah padding yang diinginkan */
        padding-top: 50px;
        padding-bottom: 50px;
    }

    .card-body {
        background-color: #f0f0f0; /* Ganti dengan warna yang diinginkan */
        padding: 20px; /* Sesuaikan dengan jumlah padding yang diinginkan */
        border-radius: 8px; /* Bordes sudut */
    }
</style>

<br>
<br>
<br>
<br>
<body></body>
<section class="section">
    <div class="container-fluid page-body-wrapper">
        <div class="main-panel">
            <div class="content-wrapper">
                <div class="col-12 grid-margin stretch-card">
                    <div class="card">
                        <div class="card-body">
                            <h2>Tambah Keperluan Alat Medis</h2>
                            <hr />
                            <form class="forms-sample" method="post">
                                <div class="form-group">
                                    <button type="button" id="btnTambahBaris" form="alatMedisForm" class="btn btn-primary">Tambah</button>
                                    <hr />
                                    <div class="table-responsive">
                                        <table id="tblKeperluanMedis" class="table">
                                            <thead>
                                                <tr>
                                                    <th>Nama Barang
                                                        <span style="color:red">*</span>
                                                        <span id="nama_barang" style="color:red;display:none;">harus diisi</span>
                                                    </th>
                                                    <th>Jumlah
                                                        <span style="color:red">*</span>
                                                        <span id="jumlah" style="color:red;display:none;">harus diisi</span>
                                                    </th>
                                                    <th>Satuan
                                                        <span style="color:red">*</span>
                                                        <span id="satuan" style="color:red;display:none;">harus diisi</span>
                                                    </th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td><input asp-for="keperluanMedis[0].kpm_nama_barang" id="nama_barang_1" class="form-control" /></td>
                                                    <td><input asp-for="keperluanMedis[0].kpm_jumlah" id="jumlah_1" class="form-control" /></td>
                                                    <td>
                                                        <select asp-for="keperluanMedis[0].kpm_satuan" id="satuan_1" class="form-control form-control-lg">
                                                            <option value="" selected disabled>Pilih Satuan</option>
                                                            <option value="buah">Buah</option>
                                                            <option value="kotak">Kotak</option>
                                                            <option value="strip">Strip</option>
                                                            <option value="botol">Botol</option>
                                                            <option value="vial">Vial</option>
                                                            <option value="ampul">Ampul</option>
                                                            <option value="tube">Tube</option>
                                                            <option value="paket">Paket</option>
                                                            <option value="dus">Dus</option>
                                                            <option value="sachet">Sachet</option>
                                                            <option value="plat">Plat</option>
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <input asp-for="keperluanMedis[0].kpm_tanggal_pengajuan" type="datetime-local" class="form-control input-with-border" value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" style="display:none;" />
                                                        <input asp-for="keperluanMedis[0].kpm_status" type="text" class="form-control input-with-border" placeholder="Status" value="menunggu konfirmasi" style="display:none;" />
                                                        <input asp-for="keperluanMedis[0].kpm_id_admin" class="form-control input-with-border" placeholder="Masukkan ID Admin" value="@httpContext.Session.GetString("Id")" style="display:none;" />
                                                        <input asp-for="keperluanMedis[0].kpm_id_manajer" class="form-control input-with-border" placeholder="Masukkan ID Manajer" value="@httpContext.Session.GetString("Id")" style="display:none;" />
                                                        <button type="button" class="btnHapusBaris btn btn-danger">Hapus</button>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <hr />
                                <button type="submit" class="btn btn-primary mr-2 submit-button">Simpan</button>
                                <a asp-controller="KeperluanMedis" asp-action="Index" class="btn btn-light">Kembali</a>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    $(document).ready(function () {
        var index = 1;

        $("#btnTambahBaris").click(function () {
            var newRow = $("<tr>");
            var cols = "";

            $("#tblKeperluanMedis").on("blur", "input, select", function () {
                document.getElementById('nama_barang').style.display = 'none';
                document.getElementById('jumlah').style.display = 'none';
                document.getElementById('satuan').style.display = 'none';

                var namaBarangError = document.getElementById('nama_barang');
                var jumlahError = document.getElementById('jumlah');
                var satuanError = document.getElementById('satuan');

                var obatRows = $("#tblKeperluanMedis tbody tr");
                var hasError = false;

                obatRows.each(function (i, row) {
                    var namaBarang = $(row).find("input[name$='kpm_nama_barang']").val();
                    var jumlah = $(row).find("input[name$='kpm_jumlah']").val();
                    var satuan = $(row).find("select[name$='kpm_satuan']").val();

                    if (!namaBarang) {
                        namaBarangError.textContent = 'harus diisi';
                        namaBarangError.style.display = 'inline';
                        hasError = true;
                    } else {
                        namaBarangError.style.display = 'none';
                    }

                    if (!jumlah) {
                        jumlahError.textContent = 'harus diisi';
                        jumlahError.style.display = 'inline';
                        hasError = true;
                    } else {
                        jumlahError.style.display = 'none';
                    }

                    if (!satuan) {
                        satuanError.textContent = 'harus diisi';
                        satuanError.style.display = 'inline';
                        hasError = true;
                    } else {
                        satuanError.style.display = 'none';
                    }
                });

                return !hasError;
            });


            cols += '<td><input name="keperluanMedis[' + index + '].kpm_nama_barang" class="form-control" /></td>';
            cols += '<td><input name="keperluanMedis[' + index + '].kpm_jumlah" class="form-control" /></td>';
            cols += '<td>' +
                '<select name="keperluanMedis[' + index + '].kpm_satuan" class="form-control input-with-border">' +
                '<option value="" selected disabled>Pilih Satuan Obat</option>' +
                '<option value="buah">Buah</option>' +
                '<option value="kotak">Kotak</option>' +
                '<option value="strip">Strip</option>' +
                '<option value="botol">Botol</option>' +
                '<option value="vial">Vial</option>' +
                '<option value="ampul">Ampul</option>' +
                '<option value="tube">Tube</option>' +
                '<option value="paket">Paket</option>' +
                '<option value="dus">Dus</option>' +
                '<option value="sachet">Sachet</option>' +
                '<option value="plat">Plat</option>' +
                '</select>' +
                '</td>';
            cols += '<td>';
            cols += '<input name="keperluanMedis[' + index + '].kpm_tanggal_pengajuan" type="datetime-local" class="form-control input-with-border" value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" style="display:none;" />';
            cols += '<input name="keperluanMedis[' + index + '].kpm_status" type="text" class="form-control input-with-border" placeholder="Status" value="menunggu konfirmasi" style="display:none;" />';
            cols += '<input name="keperluanMedis[' + index + '].kpm_id_admin" class="form-control input-with-border" placeholder="Masukkan ID Admin" value="@httpContext.Session.GetString("Id")" style="display:none;" />';
            cols += '<input name="keperluanMedis[' + index + '].kpm_id_manajer" class="form-control input-with-border" placeholder="Masukkan ID Manajer" value="@httpContext.Session.GetString("Id")" style="display:none;" />';
            cols += '<button type="button" class="btnHapusBaris btn btn-danger">Hapus</button>';
            cols += '</td>';

            newRow.append(cols);
            $("#tblKeperluanMedis tbody").append(newRow);

            index++;
        });

        $("#tblKeperluanMedis").on("click", ".btnHapusBaris", function () {
            $(this).closest("tr").remove();
        });

        $(".submit-button").click(function (e) {
            if (!validateForm()) {
                e.preventDefault();
            } else {
                // Tambahkan jeda 2 detik sebelum muncul alert
                setTimeout(function () {
                    Swal.fire("Sukses!", "Data berhasil disimpan.", "success").then(function () {
                        // Setelah alert ditutup, refresh halaman
                        window.location.reload();
                    });
                }, 2000);
            }
        });

        function validateForm() {
            var errors = [];
            // Validasi input nama barang, jumlah, dan satuan
            var obatRows = $("#tblKeperluanMedis tbody tr");
            obatRows.each(function (index, row) {
                var namaBarang = $(row).find("input[name$='kpm_nama_barang']").val();
                var jumlah = $(row).find("input[name$='kpm_jumlah']").val();
                var satuan = $(row).find("select[name$='kpm_satuan']").val();

                document.getElementById('nama_barang').style.display = 'none';
                document.getElementById('jumlah').style.display = 'none';
                document.getElementById('satuan').style.display = 'none';

                if (!namaBarang || !jumlah || !satuan) {
                    errors.push("Isi data dengan lengkap pada baris " + (index + 1));

                    if (!namaBarang) {
                        document.getElementById('nama_barang').style.display = 'inline';
                    }
                    if (!jumlah) {
                        document.getElementById('jumlah').style.display = 'inline';
                    }
                    if (!satuan) {
                        document.getElementById('satuan').style.display = 'inline';
                    }
                }


            });

            // Menampilkan pesan kesalahan obat jika ada
            if (errors.length > 0) {
                // Tambahkan jeda 2 detik sebelum muncul alert
                setTimeout(function () {
                    Swal.fire("Gagal!", errors.join("<br>"), "warning");
                }, 0);
                return false;
            }
            return true;
        }
    });

    document.addEventListener('DOMContentLoaded', function () {
        document.getElementById("nama_barang_1").addEventListener("blur", function (event) {
            // Reset previous error messages
            var namaBarangError = document.getElementById('nama_barang');
            namaBarangError.style.display = 'none';

            // Check username
            var nama_barang = this.value.trim();

            if (!nama_barang) {
                namaBarangError.textContent = 'harus diisi';
                namaBarangError.style.display = 'inline';
            }
        });

        document.getElementById("jumlah_1").addEventListener("blur", function (event) {
            // Reset previous error messages
            var jumlahError = document.getElementById('jumlah');
            jumlahError.style.display = 'none';

            // Check username
            var jumlah = this.value.trim();

            if (!jumlah) {
                jumlahError.textContent = 'harus diisi';
                jumlahError.style.display = 'inline';
            }
        });

        document.getElementById("satuan_1").addEventListener("blur", function (event) {
            // Reset previous error messages
            var satuanError = document.getElementById('satuan');
            satuanError.style.display = 'none';

            // Check username
            var satuan = this.value.trim();

            if (!satuan) {
                satuanError.textContent = 'harus diisi';
                satuanError.style.display = 'inline';
            }
        });
    });
</script>

